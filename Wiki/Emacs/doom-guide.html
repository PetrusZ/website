<!DOCTYPE html>
<html lang="zh-CN">
<head>
<!-- 2020-05-23 Sat 15:03 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Doom Guide</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Petrus.Z">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/readtheorg/js/readtheorg.js"></script>
<style> #content{max-width:1400px;}</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.cacheClassElem = elem.className;
         elem.cacheClassTarget = target.className;
         target.className = "code-highlighted";
         elem.className   = "code-highlighted";
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(elem.cacheClassElem)
         elem.className = elem.cacheClassElem;
       if(elem.cacheClassTarget)
         target.className = elem.cacheClassTarget;
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../index.html"> UP </a>
 |
 <a accesskey="H" href="/index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Doom Guide</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org325e4dd">1. Doom 基础介绍</a>
<ul>
<li><a href="#orgb4aecc2">1.1. <code>bin/doom</code> 功能</a></li>
<li><a href="#orgfbfd2fa">1.2. 外部/系统依赖</a></li>
</ul>
</li>
<li><a href="#org9d79a18">2. 更新和回滚</a>
<ul>
<li><a href="#org39c9151">2.1. 升级/降级 Emacs</a></li>
</ul>
</li>
<li><a href="#org3ded9c8">3. 迁移</a></li>
<li><a href="#orgee14685">4. 配置</a>
<ul>
<li><a href="#org06783f4">4.1. init.el</a></li>
<li><a href="#org42be74c">4.2. config.el</a></li>
<li><a href="#org89b5cc0">4.3. packages.el</a></li>
</ul>
</li>
<li><a href="#org8de4ce6">5. 模块</a></li>
<li><a href="#org46df85b">6. 包管理</a>
<ul>
<li><a href="#org749112e">6.1. 安装 packages</a></li>
<li><a href="#org378ff01">6.2. 从外部源安装 package</a></li>
<li><a href="#org9454830">6.3. Pinning package 到特定的 commits</a></li>
<li><a href="#orgafb38d6">6.4. 禁用 packages</a></li>
<li><a href="#orgae9d019">6.5. 更改已包含的 package 的 recipe</a></li>
<li><a href="#orgb248fc8">6.6. 使用/载入本地 packages</a>
<ul>
<li><a href="#org216b921">6.6.1. 调整 <code>load-path</code></a></li>
<li><a href="#org121b85d">6.6.2. :local-repo</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org77871e0">7. 配置 Doom</a>
<ul>
<li><a href="#org572d6a2">7.1. 配置 packages</a></li>
<li><a href="#org8d00d49">7.2. 重载配置</a></li>
<li><a href="#orgc024af0">7.3. 绑定按键</a></li>
</ul>
</li>
<li><a href="#orgf63e077">8. 编写自己的模块</a>
<ul>
<li><a href="#orgf34da02">8.1. 加载顺序</a></li>
<li><a href="#orga7044e3">8.2. 位置</a></li>
<li><a href="#org12709fb">8.3. 文件结构</a></li>
<li><a href="#org0b662dc">8.4. <code>init.el</code></a></li>
<li><a href="#org38953b5">8.5. <code>config.el</code></a></li>
<li><a href="#org88968e1">8.6. <code>packages.el</code></a></li>
<li><a href="#orgba474d5">8.7. <code>autoload/*.el</code> 或 <code>autoload.el</code></a></li>
<li><a href="#org54f1e7b">8.8. <code>doctor.el</code></a></li>
<li><a href="#org2ed9631">8.9. 附加文件</a></li>
<li><a href="#org153370b">8.10. Flags</a></li>
<li><a href="#org8e0f6da">8.11. Module cookies</a></li>
<li><a href="#org52dc463">8.12. Autodefs</a></li>
</ul>
</li>
<li><a href="#org7bed49a">9. 配置 Doom Emacs 时的常见错误</a>
<ul>
<li><a href="#org1316577">9.1. 急切加载 package</a></li>
<li><a href="#org4e0577c">9.2. 手动管理 package</a></li>
<li><a href="#orgb433226">9.3. 使用 <code>org-babel-do-load-languages</code> 来加载 babel packages</a></li>
<li><a href="#org5d8a9b2">9.4. 使用 <code>delete-trailing-whitespaces</code> 或 <code>whitespaces-cleanup</code> 来管理多余的 whitespace</a></li>
</ul>
</li>
<li><a href="#org6ce9584">10. Troubleshoot</a></li>
<li><a href="#org1468ff6">11. Links</a></li>
</ul>
</div>
</div>

<div id="outline-container-org325e4dd" class="outline-2">
<h2 id="org325e4dd"><span class="section-number-2">1</span> Doom 基础介绍</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgb4aecc2" class="outline-3">
<h3 id="orgb4aecc2"><span class="section-number-3">1.1</span> <code>bin/doom</code> 功能</h3>
<div class="outline-text-3" id="text-1-1">
<p>
<code>bin/doom help</code> 可查看所有命令，不过这里总结了最重要的几个：
</p>
<ul class="org-ul">
<li><code>bin/doom sync</code>: 该命令使 Doom Emacs 同步你的配置。它确保需要的 package 被安装，鼓励的程序报会被删除并正确生成必要的元数据。无论你何时修改了 <code>doom!</code> 块或 <code>packages.el</code> 文件都应运行该命令。</li>
<li><code>bin/doom upgrade</code>: 更新 Doom Emacs（如果可更新）和所有的 package。</li>
<li><code>bin/doom env</code>: （重新）生成“envvar 文件”，这是 Doom 在启动时加载的 Shell 环境快照。如果你的应用启动器或操作系统在错误的环境中启动 Emacs，那么你需要该文件。**在 MacOS 上的 GUI Emacs 用户必须使用该命令**</li>
<li><code>bin/doom doctor</code> : 如果 Doom 行为不当，doctor 会诊断你的安装，系统和环境的常见问题。</li>
<li><code>bin/doom purge</code> : 随着时间的流逝，DOom 插件的藏困会不断积累。时不时运行该命令以删除旧的、孤立的 packages，并且 与 <code>-g</code> 参数一起使用可以切换压缩现在有的 package。</li>
</ul>

<p>
使用 <code>bin/doom help</code> 查看所有 <code>bin/doom</code> 提供的可用命令，并用 <code>bin/doom help COMMAND</code> 来显示特定 <code>COMMAND</code> 的所有文档。
</p>

<blockquote>
<p>
建议将 <code>~/.emacs.d/bin</code> 添加到 <code>PATH</code> 中，所以你可以从任何地方直接调用 <code>doom</code> 。通过将以下内容添加到.bashrc 或.zshrc 文件中来达成此目的：
</p>

<p>
<code>export PATH="$HOME/.emacs.d/bin:$PATH"</code>
</p>
</blockquote>
</div>
</div>
<div id="outline-container-orgfbfd2fa" class="outline-3">
<h3 id="orgfbfd2fa"><span class="section-number-3">1.2</span> 外部/系统依赖</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Doom 由模块组成，其提供了 doom 的大部分功能，包括语言支持和与外部工具集成。其中许多具有外部依赖，你必须自己安装。你可以在模块的 README。org 文件中或通过运行 <code>bin/doom docktor</code> 找到模块所需依赖和如何安装依赖。
</p>

<blockquote>
<p>
使用 <code>M-x doom/help-modules</code> （绑定到了 <code>SPC h d m</code> 或 <code>C-h d m</code> ）来在 Doom 中跳转到一个模块的文档。否则，将光标放到 <code>boom!</code> 块中的模块上（在 <code>~/.doom.d/init.el</code> ）并按下 <code>K</code> 来跳转到它的文档（或 <code>gd</code> 跳转到它的源代码）。对于非 evil 用户，则分别使用 <code>C-c g k</code> 和 <code>C-c g d</code> 。
</p>

<p>
否则，请检查<a href="https://github.com/hlissner/doom-emacs/blob/develop/docs/modules.org">Module Index</a>。
</p>

<p>
记住文档是一项持续的工作。某些模块可能还有没有 README.org 文件。
</p>
</blockquote>
</div>
</div>
</div>
<div id="outline-container-org9d79a18" class="outline-2">
<h2 id="org9d79a18"><span class="section-number-2">2</span> 更新和回滚</h2>
<div class="outline-text-2" id="text-2">
<p>
Doom 是一个活跃的项目并且其 300+ packages 中的大多数也 package 也在积极开发中。偶尔更新 Doom 是明智的。Doom 努力使这一个过程尽可能轻松。
</p>

<p>
<code>bin/doom</code> 脚本提供了一个用于升级 DOom 和 package 的简单命令。
</p>

<p>
<code>doom upgrade  # or 'doom up'</code>
</p>

<p>
如果你想手动更新 Doom， <code>doom upgrade</code> 等于：
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #ECBE7B;">cd</span> ~/.emacs.d
<span style="color: #ECBE7B;">git</span> pull        <span style="color: #5B6268;"># </span><span style="color: #5B6268;">updates Doom</span>
doom clean      <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Ensure your config isn't byte-compiled</span>
doom sync       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">synchronizes your config with Doom Emacs</span>
doom update     <span style="color: #5B6268;"># </span><span style="color: #5B6268;">updates installed packages</span>
</pre>
</div>

<p>
仅更新 packages（不包括 Doom 自身）：
</p>

<p>
<code>doom upgrade --packages</code>
</p>

<blockquote>
<p>
Doom 暂不支持回滚。
</p>
</blockquote>
</div>
<div id="outline-container-org39c9151" class="outline-3">
<h3 id="org39c9151"><span class="section-number-3">2.1</span> 升级/降级 Emacs</h3>
<div class="outline-text-3" id="text-2-1">
<p>
<b>重要：你可能在升级/降级 Emacs 后遇到错误。</b> Emacs bytecode 通常不向前兼容。你必须重新编译或重新安装你的 packages 来解决该问题，例如：
</p>
<ul class="org-ul">
<li><code>doom build</code> 来重新构建所有已安装的 package</li>
<li>或删除 <code>~/.emacs.d/.local</code> 然后 <code>doom sync</code> 来重新安装它们</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org3ded9c8" class="outline-2">
<h2 id="org3ded9c8"><span class="section-number-2">3</span> 迁移</h2>
<div class="outline-text-2" id="text-3">
<p>
如果你来自另一个 Emacs 发行版（或你自己的发行版），在你将旧配置转换为 Doom 时，需要注意以下几点：
</p>
<ul class="org-ul">
<li><p>
Doom 不使用 <code>package.el</code> 来管理 packages，但是 <code>use-package</code> 使用 <code>package.el</code> ！如果你在 <code>use-package</code> 块中有 <code>:ensure ...</code> 属性，你会看见报错。删除这些并替代的，添加 <code>package!</code> 声明到 <code>~/.doom.d/package.el</code> 来添加你的 package。
</p>

<p>
具体见本指南中的“<a href="#org46df85b">6</a>”。
</p>

<p>
（该章节尚不完善）
</p></li>
</ul>
</div>
</div>
<div id="outline-container-orgee14685" class="outline-2">
<h2 id="orgee14685"><span class="section-number-2">4</span> 配置</h2>
<div class="outline-text-2" id="text-4">
<p>
Doom 在以下位置查找你的私有配置：
</p>
<ol class="org-ol">
<li><code>$XDG_CONFIG_HOME/doom</code></li>
<li><code>~/.doom.d</code></li>
</ol>

<p>
该目录也是 <code>DOOMDIR</code> 。
</p>

<blockquote>
<p>
你可以通过更改具有相同名称的环境变量来覆盖 <code>DOOMDIR</code> 的位置。符号链接也起作用。
</p>
</blockquote>

<p>
<code>doom install</code> 将会部署三个文件到 <code>DOOMDIR</code> ：
</p>
</div>
<div id="outline-container-org06783f4" class="outline-3">
<h3 id="org06783f4"><span class="section-number-3">4.1</span> init.el</h3>
<div class="outline-text-3" id="text-4-1">
<p>
你可以在这里找到 <code>doom!</code> 块，它控制了哪些 Doom 模块开启和以什么顺序载入。
</p>

<p>
该文件在启动过程早期被执行，在任何模块被载入之前。
</p>
</div>
</div>
<div id="outline-container-org42be74c" class="outline-3">
<h3 id="org42be74c"><span class="section-number-3">4.2</span> config.el</h3>
<div class="outline-text-3" id="text-4-2">
<p>
99.99%的个人配置应该放在这里。任何放在这里的配置将会在所有其他模块加载完运行。
</p>
</div>
</div>
<div id="outline-container-org89b5cc0" class="outline-3">
<h3 id="org89b5cc0"><span class="section-number-3">4.3</span> packages.el</h3>
<div class="outline-text-3" id="text-4-3">
<p>
在该文件中声明要安装的 package 以及从何处安装。
</p>

<blockquote>
<p>
Note：通常不要使用 <code>M-x customize</code> 或 customize API。Doom 被设计为通过 config.el 以编程方式进行配置，这可能与 Customize 的将变量写入 <code>custom-file</code> 的方式冲突。
</p>

<p>
Doom 提供了 <code>setq!</code> 宏用于触发 <code>defcustom</code> setters。
</p>
</blockquote>
</div>
</div>
</div>
<div id="outline-container-org8de4ce6" class="outline-2">
<h2 id="org8de4ce6"><span class="section-number-2">5</span> 模块</h2>
<div class="outline-text-2" id="text-5">
<p>
Doom 包含大约 130 个模块。一个 Doom 模块是 a bundle of packages、配置和命令，组织成一个可以通过从 <code>doom!</code> block（可以在 <code>$DOOMDIR/init.el</code> 中找到）添加或删除它们来启用或禁用的但原。
</p>

<p>
<code>doom!</code> block 看起来会像是这样：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;; </span><span style="color: #5B6268;">To comment something out, you insert at least one semicolon before it. The</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Emacs Lisp interpreter will ignore whatever follows.</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">doom!</span> <span style="color: #c678dd;">:lang</span>
       python        <span style="color: #5B6268;">; </span><span style="color: #5B6268;">this module is not commented, therefore enabled</span>
       <span style="color: #5B6268;">;;</span><span style="color: #5B6268;">javascript  ; this module is commented out, therefore disabled</span>
       <span style="color: #5B6268;">;;</span><span style="color: #5B6268;">lua         ; this module is disabled</span>
       ruby          <span style="color: #5B6268;">; </span><span style="color: #5B6268;">this module is enabled</span>
       php<span style="color: #51afef;">)</span>          <span style="color: #5B6268;">; </span><span style="color: #5B6268;">this module is enabled</span>
</pre>
</div>

<p>
它控制哪些模块开启和以什么顺序载入。一些模块有 <b>可选的功能</b> ，可以通过传递 flags（以加好前缀表示）开启这些功能：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">doom!</span> <span style="color: #c678dd;">:completion</span>
       <span style="color: #c678dd;">(</span>company +auto<span style="color: #c678dd;">)</span>
       <span style="color: #c678dd;">:lang</span>
       <span style="color: #c678dd;">(</span>csharp +unity<span style="color: #c678dd;">)</span>
       <span style="color: #c678dd;">(</span>org +brain +dragndrop +gnuplot +hugo +jupyter<span style="color: #c678dd;">)</span>
       <span style="color: #c678dd;">(</span>sh +fish<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
不同的模块支持不同的的 flags。模块不识别的 flags 将会被忽略。你可以在 Module Index 中找到可用模块及其支持的 flags 的完整列表。
</p>

<blockquote>
<p>
<b>重要</b> ：不要忘记在改变 <code>doom!</code> block 后运行 =bin/doom sync=，然后重新启动 Emacs 以使更改生效。
</p>
</blockquote>

<blockquote>
<p>
运行 <code>doom doctor</code> 来决定 <code>doom!</code> block 是否有任何问题，例如重复或拼写错误的模块。
</p>
</blockquote>
</div>
</div>
<div id="outline-container-org46df85b" class="outline-2">
<h2 id="org46df85b"><span class="section-number-2">6</span> 包管理</h2>
<div class="outline-text-2" id="text-6">
<p>
<b>Doom Emacs 不使用 package.el</b> （Emacs 内置的包管理器）。替代的，doom 使用自己的构建在<a href="https://github.com/raxod502/straight.el">Straight</a>之上的陈述式包管理器。
</p>

<blockquote>
<p>
如果你来自另一个 Emacs 发行版（或原生 Emacs），注意 <code>use package</code> block 中的 <code>:ensure</code> 属性，因为它会尝试（并且失败）通过 package.el 安装 packages。
</p>
</blockquote>

<p>
Package 在 Doom 模块中的 <code>packages.el</code> 文件中声明。这也适用于 <code>DOOMDIR</code> ，其被视为一个模块。你可以在 <code>~/.doom.d/packages.el</code> 中安装自己的 packages。
</p>

<blockquote>
<p>
如果一个 package 没有使用 <code>package!</code> 声明安装（例如，使用 <code>M-x package-install</code> 或 <code>M-x straight-use-package</code> ），它将会在下一次运行 <code>bin/doom sync</code> 或 <code>bin/doom purge</code> 时被删除。
</p>
</blockquote>
</div>

<div id="outline-container-org749112e" class="outline-3">
<h3 id="org749112e"><span class="section-number-3">6.1</span> 安装 packages</h3>
<div class="outline-text-3" id="text-6-1">
<p>
要安装一个 package，添加 <code>package!</code> 声明到 <code>DOOMDIR/packages.el</code> 。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#20174;ELPA&#25110;MELPA&#23433;&#35013;&#21517;&#20026;&#8220;example&#8221;&#30340;package</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> example<span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#25110;&#32773;&#21578;&#35785;Doom&#23436;&#20840;&#19981;&#31649;&#29702;&#29305;&#23450;&#30340;package</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> example <span style="color: #c678dd;">:ignore</span> t<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
<code>package!</code> 将返回 non-nil 如果 package 明确要安装并且没有在其他地方被禁用。使用这个事实可以将 package 依赖关系链接到一起。例如：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">package!</span> example<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">package!</span> plugin-that-example-depends-on<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org378ff01" class="outline-3">
<h3 id="org378ff01"><span class="section-number-3">6.2</span> 从外部源安装 package</h3>
<div class="outline-text-3" id="text-6-2">
<p>
为了直接从一个外部源（像 github、gitlab 等）安装一个 package，你需要指定一个<a href="https://github.com/raxod502/straight.el#the-recipe-format">MELPA-style straight recipe</a>：
</p>

<p>
这里有几个例子：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#30452;&#25509;&#20174;github&#20179;&#24211;&#23433;&#35013;&#12290;&#20026;&#20102;&#27491;&#24120;&#24037;&#20316;&#65292;package&#24517;&#39035;&#26377;&#19968;&#20010;&#36866;&#24403;&#30340;PACKAGENAME.el&#25991;&#20214;&#65292;&#20854;&#24517;&#39035;&#33267;&#23569;&#21253;&#21547;&#19968;&#20010;Package&#8212;Version&#25110;&#22312;&#22836;&#37096;&#26377;Version&#34892;&#12290;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> example
  <span style="color: #c678dd;">:recipe</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:host</span> github <span style="color: #c678dd;">:repo</span> <span style="color: #98be65;">"username/my-example-fork"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#22914;&#26524;package&#30340;&#28304;&#25991;&#20214;&#22312;&#25152;&#36848;&#20179;&#24211;&#30340;&#23376;&#30446;&#24405;&#20013;&#65292;&#20351;&#29992; ':files' &#26469;&#30596;&#20934;&#23427;&#20204;&#12290;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> example <span style="color: #c678dd;">:recipe</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:host</span> github
   <span style="color: #c678dd;">:repo</span> <span style="color: #98be65;">"username/my-example-fork"</span>
   <span style="color: #c678dd;">:files</span> <span style="color: #98be65;">(</span><span style="color: #98be65;">"*.el"</span> <span style="color: #98be65;">"src/lisp/*.el"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#33719;&#21462;&#29305;&#23450;&#30340;&#20998;&#25903;&#25110;&#26631;&#31614;&#65306;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> example <span style="color: #c678dd;">:recipe</span>
  <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:host</span> gitlab
   <span style="color: #c678dd;">:repo</span> <span style="color: #98be65;">"username/my-example-fork"</span>
   <span style="color: #c678dd;">:branch</span> <span style="color: #98be65;">"develop"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#22914;&#26524;&#19968;&#20010;package&#30340;&#40664;&#35748;recipe&#22312;MELPA&#25110;emacsmirror&#19978;&#65292;&#20320;&#21487;&#20197;&#30465;&#30053;&#20851;&#38190;&#35789;&#24182;&#19988;recipe&#23558;&#20250;&#20174;&#23427;&#20204;&#30340;&#28304;&#32487;&#25215;&#21097;&#20313;&#30340;reciple&#12290;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> example <span style="color: #c678dd;">:recipe</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:branch</span> <span style="color: #98be65;">"develop"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#22914;&#26524;&#20179;&#24211;&#24341;&#20837;&#20102;&#35768;&#22810;&#19981;&#38656;&#35201;&#30340;&#23376;&#27169;&#22359;&#65292;&#20320;&#21487;&#20197;&#31105;&#29992;&#36882;&#24402;clone</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> example <span style="color: #c678dd;">:recipe</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:nonrecursive</span> t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#19968;&#20010;package&#21487;&#20197;&#36890;&#36807;&#35774;&#32622;:host&#20026;nil&#30452;&#25509;&#20174;git&#20179;&#24211;&#23433;&#35013;&#65306;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> example
  <span style="color: #c678dd;">:recipe</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:host</span> nil <span style="color: #c678dd;">:repo</span> <span style="color: #98be65;">"https://some/git/repo"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
<code>package!</code> 宏的 <code>:recipe</code> 的规格在<a href="https://github.com/raxod502/straight.el#the-recipe-format">Straight.el’s README</a>中。
</p>

<blockquote>
<p>
<b>重要</b> ：每当你修改 packages.el 文件时， 运行 <code>bin/doom sync</code> 以确保更改生效。
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org9454830" class="outline-3">
<h3 id="org9454830"><span class="section-number-3">6.3</span> Pinning package 到特定的 commits</h3>
<div class="outline-text-3" id="text-6-3">
<p>
所有 Doom 的 package 默认被 pinned。一个 pinned 的 package 时锁定到特定 commit 的 package，如下：
</p>

<p>
<code>package! evil :pin "e00626d9fd"</code>
</p>

<p>
要 unpin 一个 package，使用 <code>unpin!</code> 宏：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">unpin!</span> evil<span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#21487;&#20197;&#19968;&#27425;unpin&#22810;&#20010;packages</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">unpin!</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:lang</span> python ruby rust<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:tools</span> docker<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;;</span><span style="color: #5B6268;">&#25110;unpin&#25972;&#20010;&#27169;&#22359;&#30340;&#30446;&#24405;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">unpin!</span> <span style="color: #c678dd;">:completion</span> <span style="color: #c678dd;">:lang</span> <span style="color: #c678dd;">:tools</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#36825;&#26679;&#20063;&#21487;&#20197;&#24037;&#20316;&#65292;&#22914;&#26524;&#20320;&#26356;&#21916;&#27426;&#36825;&#31181;&#35821;&#27861;&#65292;&#20294;&#36825;&#26679;&#24182;&#19981;&#31616;&#27905;</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">unpinning&#22810;&#20010;packages&#30340;&#35821;&#27861;&#65306;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> helm <span style="color: #c678dd;">:pin</span> nil<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
尽管 <b>强烈</b> 不鼓励这样做，但你可以 unpin 所有的 packages 并使 Doom Emacs 滚动发布：
</p>

<p>
<code>(unpin! t)</code>
</p>

<blockquote>
<p>
unpin 所有的 packages 时不鼓励的，因为 Doom 的模块是针对 pinned 版本的 packages 而设计的。易失性较高的 packages（如 lsp-mode，ein 和 org）变化迅速，并且如果 unpin 它们，则很可能造成损坏。
</p>

<p>
相反，一个更好的主意是选择性的 unpin packages，或将其 repin 到你想要的确切 commit。
</p>
</blockquote>
</div>
</div>
<div id="outline-container-orgafb38d6" class="outline-3">
<h3 id="orgafb38d6"><span class="section-number-3">6.4</span> 禁用 packages</h3>
<div class="outline-text-3" id="text-6-4">
<p>
<code>package!</code> 宏可以处理 <code>:disable</code> 属性：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> irony <span style="color: #c678dd;">:disable</span> t<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> rtags <span style="color: #c678dd;">:disable</span> t<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
一旦 package 被禁用， 它的 <code>use-packages!</code> 和 <code>after!</code> blocks 将会被忽略，并且 package 将会在下一次运行 <code>bin/doom sync</code> 时被删除。 使用此功能来禁用不需要或不想要的 Doom 的 packages。
</p>

<p>
还有 <code>disable-packages!</code> 宏可以方便的禁用多个 packages：
</p>

<p>
<code>(disable-packages! irony rtags)</code>
</p>

<blockquote>
<p>
<b>重要</b> ：每当你修改 packages.el 文件时， 运行 <code>bin/doom sync</code> 以确保更改生效。
</p>
</blockquote>
</div>
</div>
<div id="outline-container-orgae9d019" class="outline-3">
<h3 id="orgae9d019"><span class="section-number-3">6.5</span> 更改已包含的 package 的 recipe</h3>
<div class="outline-text-3" id="text-6-5">
<p>
如果一个 Doom 模块从一个地方安装 package X，但是你想要从另一个地方安装，为它在 <code>DOOMDIR/packages.el</code> 添加 <code>package!</code> 声明。个人声明总是优先于模块（甚至是自己的）。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;; </span><span style="color: #5B6268;">in modules/editor/evil/packages.el</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> evil<span style="color: #51afef;">)</span> <span style="color: #5B6268;">; </span><span style="color: #5B6268;">installs from MELPA</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">in DOOMIDR/packages.el</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> evil <span style="color: #c678dd;">:recipe</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:host</span> github <span style="color: #c678dd;">:repo</span> <span style="color: #98be65;">"username/my-evil-fork"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
仅当内置 package 不存在时才安装 package，使用 <code>:build-in 'prefer</code> ：
</p>

<p>
<code>(package! so-long :built-in 'prefer)</code>
</p>

<blockquote>
<p>
<b>重要</b> ：每当你修改 packages.el 文件时， 运行 <code>bin/doom sync</code> 以确保更改生效。
</p>
</blockquote>
</div>
</div>
<div id="outline-container-orgb248fc8" class="outline-3">
<h3 id="orgb248fc8"><span class="section-number-3">6.6</span> 使用/载入本地 packages</h3>
<div class="outline-text-3" id="text-6-6">
<p>
如果你要安装本地的 elisp package。你有两个选择：
</p>
</div>
<div id="outline-container-org216b921" class="outline-4">
<h4 id="org216b921"><span class="section-number-4">6.6.1</span> 调整 <code>load-path</code></h4>
<div class="outline-text-4" id="text-6-6-1">
<p>
Emacs 会在 <code>load-path</code> 中搜索 packages。添加你的 package 的路径当试图载入它时，Emacs 会找到它。例如：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">add-load-path!</span> <span style="color: #98be65;">"lisp/package"</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">or</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package</span> my-package
  <span style="color: #c678dd;">:load-path</span> <span style="color: #98be65;">"/path/to/my/package"</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org121b85d" class="outline-4">
<h4 id="org121b85d"><span class="section-number-4">6.6.2</span> :local-repo</h4>
<div class="outline-text-4" id="text-6-6-2">
<p>
或者，你可以在 <code>package!</code> 的 <code>:recipe</code> 声明中指定 <code>:local-repo</code> ：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> my-package <span style="color: #c678dd;">:recipe</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:local-repo</span> <span style="color: #98be65;">"/path/to/my/package"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#19981;&#35201;&#24536;&#35760;&#22312;&#38750;&#24120;&#35268;&#39033;&#30446;&#32467;&#26500;&#20013;&#20351;&#29992; :files &#26469;&#21253;&#21547;&#25991;&#20214;&#65306;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">package!</span> my-package
  <span style="color: #c678dd;">:recipe</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">:local-repo</span> <span style="color: #98be65;">"/path/to/my/package"</span>
           <span style="color: #c678dd;">:files</span> <span style="color: #98be65;">(</span><span style="color: #98be65;">"*.el"</span> <span style="color: #98be65;">"src/lisp/*.el"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
记住运行 <code>doom sync</code> 来在你更改它后重新构建 package，并重新索引其中所有的 autoloads。
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org77871e0" class="outline-2">
<h2 id="org77871e0"><span class="section-number-2">7</span> 配置 Doom</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org572d6a2" class="outline-3">
<h3 id="org572d6a2"><span class="section-number-3">7.1</span> 配置 packages</h3>
<div class="outline-text-3" id="text-7-1">
<p>
如果你的配置需求很简单，那么 <code>use-package!</code> ， <code>after!</code> ， <code>add-hook!</code> 和 <code>setq-hook!</code> 宏时你的面包和黄油。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">~/.doom.d/config.el (example)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">doom-font</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">font-spec</span> <span style="color: #c678dd;">:family</span> <span style="color: #98be65;">"Hack NF"</span> <span style="color: #c678dd;">:size</span> <span style="color: #da8548; font-weight: bold;">12</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Take a feature symbol or a library name(string)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">after!</span> evil
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">evil-magic</span> nil<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Take a major-mode, a quoted hook function or a list of either</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">add-hook!</span> python-mode
    <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> python-shell-interpreter <span style="color: #98be65;">"bpython"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#36825;&#20123;&#26159;&#30456;&#31561;&#30340;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq-hook!</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">python-mode-hook</span><span style="color: #51afef;">'</span> <span style="color: #ECBE7B;">python-indent-offset</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">setq-hook!</span> python-mode python-indent-offset <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> hl-todo
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#22914;&#26524;&#20320;&#30465;&#30053; :defer&#65292;:hook&#65292;:commands&#25110;:after&#65292;&#37027;&#20040;package&#34987;&#31435;&#21051;&#36733;&#20837;&#12290;</span>
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#36890;&#36807;&#22312;&#36825;&#37324;&#20351;&#29992;:hook&#65292;`hl-todo` package&#19981;&#20250;&#34987;&#36733;&#20837;&#65292;&#30693;&#36947;prog-mode-hook&#34987;&#35302;&#21457;&#65288;&#36890;&#36807;&#28608;&#27963;&#20174;&#23427;&#27966;&#29983;&#30340;&#20027;&#35201;&#27169;&#24335;&#65292;&#20363;&#22914;python-mode</span>
  <span style="color: #c678dd;">:hook</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">prog-mode</span> . <span style="color: #dcaeea;">hl-todo-mode</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:init</span>
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#36825;&#37324;&#30340;&#20195;&#30721;&#20250;&#31435;&#21051;&#36816;&#34892;</span>
  <span style="color: #c678dd;">:config</span>
  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#36825;&#37324;&#30340;&#20195;&#30721;&#20250;&#22312;package&#34987;&#36733;&#20837;&#20043;&#21518;&#36816;&#34892;</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">hl-todo-highlight-punctuation</span> <span style="color: #98be65;">":"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
为了更多的灵活性， <code>use-package-hook!</code> 是另一个选项，但其应被视为最后一个选项（因为通常有更好的方法）。它允许禁用、append/prepend 和/或覆盖 Doom 的 <code>use-package!</code> blocks。这些由 <code>use-package</code> 的 inject-hook under the hood 驱动的。
</p>

<p>
<code>use-package-hook!</code> <b>必须在 package 的 <code>use-package!</code> block 之前使用</b> 。因此它必须在个人的 init.el 文件中使用。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;; </span><span style="color: #5B6268;">~/.doom.d/init.el (example)</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#22914;&#26524;&#19968;&#20010; :pre-init / :pre-config hook&#36820;&#22238;nil&#65292;i&#23427;&#20250;&#35206;&#30422;package&#30340;&#21407;&#26377;&#30340; :init / :config block&#12290;</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#21033;&#29992;&#35813;&#26041;&#24335;&#26469;&#35206;&#30422;Doom&#30340;&#37197;&#32622;&#12290;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package-hook!</span> doom-themes
  <span style="color: #c678dd;">:pre-config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> doom-neotree-file-icons t<span style="color: #c678dd;">)</span>
  nil<span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">...&#21542;&#21017;&#65292;&#30830;&#20445;&#23427;&#20204;&#24635;&#26159;&#36820;&#22238;non-nil&#65281;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package-hook!</span> evil
  <span style="color: #c678dd;">:pre-init</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">evil-magic</span> nil<span style="color: #c678dd;">)</span>
  t<span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">`use-package-hook` &#20063;&#26377; :post-init &#21644; :ppost-config hooks</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org8d00d49" class="outline-3">
<h3 id="org8d00d49"><span class="section-number-3">7.2</span> 重载配置</h3>
<div class="outline-text-3" id="text-7-2">
<p>
你可能会发现让你的改变立即发挥作用非常帮助。对于不需要完全重启 Doom Emacs 的事情（像改变开启的模块或安装的 package），你可以即时评估 Emacs Lisp 代码。
</p>
<ul class="org-ul">
<li><p>
evil 用户可以使用 <code>gr</code> 操作符来苹果一段代码。返回值会显示在 minibuffer 或 popup（如果结果足够大）中。
</p>

<p>
<code>gr</code> 对于大多数语言都能正常工作，但是在 Elisp 中使用它是一个特殊情况；它会在你当前的 Emacs 会话中执行。你可以使用该方法即时修改 Emacs 的状态。
</p></li>
<li>非 evil 用户可以使用 <code>C-x C-e</code> 来运行 <code>eval-last-sexp</code> ，以及 <code>M-x +eval/buffer-or-region</code> （绑定在 <code>SPC c e</code> ）。</li>
<li>另一个选项是用 <code>SPC x</code> 开一个 scratch buffer，改变它的主要模式（ <code>M-x emacs-lisp-mode</code> ），并使用上述的快捷键来评估代码。</li>
<li>可以通过按 <code>SPC o r</code> （ <code>+eval/open-repl-other-window</code> ）来使用 ielm REPL。</li>
<li>还有 <code>M-:</code> 或 <code>SPC ;</code> ，其调用 <code>eval-expression</code> ，让你可以运行 elisp 代码 inline。</li>
</ul>

<p>
尽管所有这些都有助于重新配置正在运行的 Emacs 会话，但也有助于调试。
</p>
</div>
</div>
<div id="outline-container-orgc024af0" class="outline-3">
<h3 id="orgc024af0"><span class="section-number-3">7.3</span> 绑定按键</h3>
<div class="outline-text-3" id="text-7-3">
<ul class="org-ul">
<li>define-key</li>
<li>global-set-key</li>
<li>map!</li>
<li>undefine-key!</li>
<li>define-key!</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgf63e077" class="outline-2">
<h2 id="orgf63e077"><span class="section-number-2">8</span> 编写自己的模块</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-orgf34da02" class="outline-3">
<h3 id="orgf34da02"><span class="section-number-3">8.1</span> 加载顺序</h3>
<div class="outline-text-3" id="text-8-1">
<p>
模块文件以精确的顺序加载：
</p>

<ol class="org-ol">
<li><code>~/.emacs.d/early-init.el</code> (Emacs 27+ only)</li>
<li><code>~/.emacs.d/init.el</code></li>
<li><code>$DOOMDIR/init.el</code></li>
<li><code>{~/.emacs.d, $DOOMDIR}/modules/*/*/init.el</code></li>
<li><code>{~/.emacs.d, $DOOMDIR}/modules/*/*/config.el</code></li>
<li><code>$DOOMDIR/config.el</code></li>
</ol>
</div>
</div>
<div id="outline-container-orga7044e3" class="outline-3">
<h3 id="orga7044e3"><span class="section-number-3">8.2</span> 位置</h3>
<div class="outline-text-3" id="text-8-2">
<p>
Doom 在 <code>~/.emacs.d/modules/CATEGORY/MODULE/</code> 和 <code>$DOOMDIR/modules/CATEGORY/MODULE</code> 搜索模块。如果你有一个个人模块和 Doom 包含的模块名相同，将会隐藏包含的那一个（好像包含的那个从未存在过）。
</p>

<blockquote>
<p>
Doom 用以下两种格式之一指明模块： <code>:category module</code> 或 <code>category/module</code>
</p>
</blockquote>
</div>
</div>
<div id="outline-container-org12709fb" class="outline-3">
<h3 id="org12709fb"><span class="section-number-3">8.3</span> 文件结构</h3>
<div class="outline-text-3" id="text-8-3">
<p>
一个模块由数个文件组成，所有文件都是可选的。他们是：
</p>

<pre class="example">
modules/
  category/
    module/
      test/*.el
      autoload/*.el
      autoload.el
      init.el
      config.el
      packages.el
      doctor.el
</pre>
</div>
</div>
<div id="outline-container-org0b662dc" class="outline-3">
<h3 id="org0b662dc"><span class="section-number-3">8.4</span> <code>init.el</code></h3>
<div class="outline-text-3" id="text-8-4">
<p>
该文件在早期被载入，在其他任何文件之前，但是在 Doom core 载入之后。
</p>

<p>
使用该文件来：
</p>
<ul class="org-ul">
<li>配置 Emacs 或执行必须在早期色号只的/拆卸的操作；在其他模块（或本模块）被加载之前。</li>
<li>使用 <code>use-package-hook!</code> 重新配置定义在 Doom 里的 package（作为最后一种手段，当 <code>after!</code> 和 hook 都不足够的时候）。</li>
<li>改变 <code>bin/doom</code> 的行为</li>
</ul>

<p>
<b>不</b> 要使用该文件来：
</p>
<ul class="org-ul">
<li>使用 <code>use-package!</code> 或 <code>after!</code> 来配置 packages</li>
<li>执行昂贵的或容易出错的操作；这些文件会在每当 <code>bin/doom</code> 使用时被评估。</li>
</ul>
</div>
</div>
<div id="outline-container-org38953b5" class="outline-3">
<h3 id="org38953b5"><span class="section-number-3">8.5</span> <code>config.el</code></h3>
<div class="outline-text-3" id="text-8-5">
<p>
该文件是每个模块的核心。
</p>

<p>
该文件中的代码应该预期依赖（在 <code>packages.el</code> 中）是已安装并可用的，但不应该假设哪些模块已被激活（使用 <code>featurep!</code> 来检测它们）。
</p>

<p>
package 应该使用 <code>after!</code> 或 <code>use-package!</code> 来配置：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;; </span><span style="color: #5B6268;">from modules/completion/company/config.el</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">use-package!</span> company
  <span style="color: #c678dd;">:commands</span> <span style="color: #c678dd;">(</span><span style="color: #dcaeea;">company-mode</span> <span style="color: #dcaeea;">global-company-mode</span> company-complete
             company-complete-common company-manual-begin company-grab-line<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">:config</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">setq</span> <span style="color: #dcaeea;">company-idle-delay</span> nil
        <span style="color: #dcaeea;">company-tooltip-limit</span> <span style="color: #da8548; font-weight: bold;">10</span>
        <span style="color: #dcaeea;">company-dabbrev-downcase</span> nil
        <span style="color: #dcaeea;">company-dabbrev-ignore-case</span> nil<span style="color: #c678dd;">)</span>
   <span style="color: #c678dd;">[</span>...<span style="color: #c678dd;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<blockquote>
<p>
对于已经熟悉 <code>use-package</code> 的人来说， <code>use-package!</code> 仅是一个简单的包装。它支持所有相同的关键词并可以以几乎相同的方式使用。
</p>
</blockquote>
</div>
</div>
<div id="outline-container-org88968e1" class="outline-3">
<h3 id="org88968e1"><span class="section-number-3">8.6</span> <code>packages.el</code></h3>
<div class="outline-text-3" id="text-8-6">
<p>
该文件是 package 升 ingde 地方。如果你像查看一个模块在管理哪些 packages（以及它们从何处安装），它也是一个好地方来查看。
</p>

<p>
一个 <code>packages.el</code> 文件不应该包含复杂逻辑。通常是条件语句和 <code>package!</code> 、 <code>disable-package!</code> 或 <code>depend-on!</code> 调用。它不应该产生副作用，并应该具有确定性。因为该文件在一个与你的交换会话隔离的环境中被评估，因此其中的代码不应该对当前会话进行任何假设。
</p>

<p>
详细信息见<a href="#org46df85b">6</a>章节。
</p>
</div>
</div>
<div id="outline-container-orgba474d5" class="outline-3">
<h3 id="orgba474d5"><span class="section-number-3">8.7</span> <code>autoload/*.el</code> 或 <code>autoload.el</code></h3>
<div class="outline-text-3" id="text-8-7">
<p>
这些文件中标记有 autoload cookie（ <code>;;;##autoload</code> ）的函数会将被延迟加载。
</p>

<p>
当你运行 <code>bin/doom autoloads</code> ，Doom 会扫描这些文件以将 autoload 文件填充到 <code>~/.emacs.d/.local/autoloads.el</code> ，该文件会告诉 Emacs 当这些函数被调用时在哪里可以找到它们。
</p>

<p>
例如：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;; </span><span style="color: #5B6268;">from modules/lang/org/autoload/org.el</span>
<span style="color: #5B6268;">;;;</span><span style="color: #5B6268;">###</span><span style="color: #ECBE7B;">autoload</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">+org/toggle-checkbox</span> <span style="color: #c678dd;">()</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">[</span>...<span style="color: #c678dd;">]</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">from modules/lang/org/autoload/evil.el</span>
<span style="color: #5B6268;">;;;</span><span style="color: #5B6268;">###</span><span style="color: #ECBE7B;">autoload</span><span style="color: #5B6268;"> (autload '+org:attach "lang/org/autoload/evil" nil t)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">evil-define-command</span> <span style="color: #c678dd;">+org:attach</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">&amp;optional</span> uri<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">interactive</span> <span style="color: #98be65;">"&lt;a&gt;"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">[</span>...<span style="color: #c678dd;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org54f1e7b" class="outline-3">
<h3 id="org54f1e7b"><span class="section-number-3">8.8</span> <code>doctor.el</code></h3>
<div class="outline-text-3" id="text-8-8">
<p>
该文件被 <code>make doctor</code> 使用，并且应该为模块所有的依赖测试。如果缺少一个，它应该使用 <code>warn!</code> 、 <code>error!</code> 和 <code>explain!</code> 宏告诉用户为什么会出现问题，并且理想情况下，提供一个解决问题的方法。
</p>

<p>
例如， <code>:lang cc</code> 模块的 doctor 简直是否已安装了 irony server：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;; </span><span style="color: #5B6268;">from lang//cc/doctor.el</span>
<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">require</span> <span style="color: #51afef;">'</span><span style="color: #a9a1e1;">irony</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">unless</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">file-directory-p</span> irony-server-install-prefix<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">warn!</span> <span style="color: #98be65;">"Irony server isn't installed, Run M-x irony-install-server"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org2ed9631" class="outline-3">
<h3 id="org2ed9631"><span class="section-number-3">8.9</span> 附加文件</h3>
<div class="outline-text-3" id="text-8-9">
<p>
有时，最好将模块的 config.el 文件拆分为多个文件。惯例是将这些附加文件的的名称前加上 <code>+</code> ，例如 <code>modules/feature/version-control/+git.el</code> 。
</p>

<p>
该惯例没有语法或功能上的意义。目录必须遵循此惯例，这些目录中的文件也不必遵循。
</p>

<p>
这些附加文件 <b>不</b> 会被自动加载。 你需要使用 <code>!load</code> 宏来加载：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;; </span><span style="color: #5B6268;">from modules/feature/version-control/config.el</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">load!</span> +git<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
<code>load!</code> 宏会长时加载相对于当前文件的 =+git.el=。
</p>
</div>
</div>
<div id="outline-container-org153370b" class="outline-3">
<h3 id="org153370b"><span class="section-number-3">8.10</span> Flags</h3>
<div class="outline-text-3" id="text-8-10">
<p>
一个模块的 flag 可以是任意符号。惯例这些符号以 <code>+</code> 或 <code>-</code> 为前缀，分别表示添加或删除功能。该符号没有功能上的意义。
</p>

<p>
一个模块可以根据自己的喜好选择解释 flags。它们可以用 <code>featurep!</code> 宏测试：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#24403;&#21069;&#27169;&#22359;&#26159;&#21542;&#24050;&#21551;&#29992;+my-feature flag&#65311;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">featurep!</span> +my-feature<span style="color: #c678dd;">)</span> ...<span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#23427;&#21487;&#20197;&#29992;&#20110;&#26816;&#26597;&#20854;&#20182;&#27169;&#22359;&#20013;flag&#26159;&#21542;&#23384;&#22312;&#65306;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">when</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">featurep!</span> <span style="color: #c678dd;">:lang</span> python +lsp<span style="color: #c678dd;">)</span> ...<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org8e0f6da" class="outline-3">
<h3 id="org8e0f6da"><span class="section-number-3">8.11</span> Module cookies</h3>
<div class="outline-text-3" id="text-8-11">
<p>
一个特别的语法存在叫做 module cookies。像 autoload cookies ( <code>;;;###autoload</code> )，模块文件可能在或接进文件头部的地方有 <code>;;;###if FORM</code> 。读取 FORM 可以确定是否在扫描该文件进行 autoloads（ <code>doom sync</code> ）或 byte-compiling（ <code>doom compile</code> ）时忽略该文件。
</p>

<p>
使用此功能可以防止错误发生，比如，如果文件包含（例如）调用不存在的函数如果一个特定功能对该模块不可用，例如：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;;</span><span style="color: #5B6268;">###</span><span style="color: #ECBE7B;">if</span><span style="color: #5B6268;"> (featurep! +lsp)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;;</span><span style="color: #5B6268;">###</span><span style="color: #ECBE7B;">if</span><span style="color: #5B6268;"> (not (locate-library "so-long"))</span>
</pre>
</div>

<p>
记住，它们在一个有限的、非交互式子会话中运行，所以不要在未启用任何模块的情况下调用 Doom 会话中不可用的任何内容。
</p>
</div>
</div>
<div id="outline-container-org52dc463" class="outline-3">
<h3 id="org52dc463"><span class="section-number-3">8.12</span> Autodefs</h3>
<div class="outline-text-3" id="text-8-12">
<p>
autodef 是一种特殊的 autoloaded 函数或宏，无乱是否启用了其包含的模块，Doom 都保证会始终被定义（但当被禁用时不会对其参数进行评估操作）。
</p>

<p>
你可以使用 <code>M-x doom/help-autodefs</code> （ <code>SPC h d u</code> 或 <code>C-h d u</code> ）浏览在当前会话中可用的 autodefs。
</p>

<p>
使 autodef 与常规 autoload 区别开来的时 <code>;;;###autodef</code> cookie：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;;;</span><span style="color: #5B6268;">###</span><span style="color: #ECBE7B;">autodef</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">set-something!</span> <span style="color: #c678dd;">(</span>value<span style="color: #c678dd;">)</span>
  ...<span style="color: #51afef;">)</span>
</pre>
</div>

<p>
一个例子时 <code>:completion company</code> 模块暴露的 <code>set-company-backend!</code> 函数。它允许你在特定的主要模式中注册 company 补全的 backeds。例如：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #c678dd;">set-company-backend!</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">python-mode</span> <span style="color: #51afef;">'</span><span style="color: #c678dd;">(</span>company-anaconda<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org7bed49a" class="outline-2">
<h2 id="org7bed49a"><span class="section-number-2">9</span> 配置 Doom Emacs 时的常见错误</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-org1316577" class="outline-3">
<h3 id="org1316577"><span class="section-number-3">9.1</span> 急切加载 package</h3>
<div class="outline-text-3" id="text-9-1">
<p>
在没有延迟关键字（ <code>:defer :after :commands :defer-incrementally :after-call</code> 之一）情况下使用 <code>use-package!</code> 将会立即载入 package。这回导致其他 packages 被拉取并加载，从而违纪 Doom 的许多启动优化。
</p>
</div>
</div>
<div id="outline-container-org4e0577c" class="outline-3">
<h3 id="org4e0577c"><span class="section-number-3">9.2</span> 手动管理 package</h3>
<div class="outline-text-3" id="text-9-2">
<p>
许多 Emacs 文档和帮助都会包含使用 package.el 的 API（例如 <code>package-install</code> ）或使用 use-package 的 <code>:ensure</code> 关键字来安装 package 的建议。如果你愿意，你可以这样做，否则，Doom 拥有自己的 package 管理系统。
</p>

<p>
从 <code>use-package</code> 代码迁移到 Doom 通过只需要删除 <code>:ensure</code> 关键字并添加 <code>(package! PACKAGENAME)</code> 到 <code>~/.doom.d/package.el</code> （并运行 <code>doom sync</code> 同步你的配置）。
</p>
</div>
</div>
<div id="outline-container-orgb433226" class="outline-3">
<h3 id="orgb433226"><span class="section-number-3">9.3</span> 使用 <code>org-babel-do-load-languages</code> 来加载 babel packages</h3>
<div class="outline-text-3" id="text-9-3">
<p>
你不需要 <code>org-babel-do-load-languages</code> 。Doom 会基于在 <code>#+BEGIN_SRC</code> blocks 中的语言名按需 lazy load babel package。只要 babel 插件已安装并且插件以它的语言命名（例如， <code>#+BEGIN_SRC rust</code> 会载入 <code>ob-rust</code> ），你不需要做其他任何操作。
</p>

<p>
然而，可能会有一些特殊的例子。Doom 尝试处理其中的几个（例如，ob-jupyter、ob-ipython 和 ob-async）。如果你在 org src blocks 中在尝试使用特定语言时遇到错误，查看<a href="https://github.com/hlissner/doom-emacs/blob/develop/modules/lang/org/README.org">:lang org module documentation</a>以获取如果添加支持的具体信息。
</p>
</div>
</div>
<div id="outline-container-org5d8a9b2" class="outline-3">
<h3 id="org5d8a9b2"><span class="section-number-3">9.4</span> 使用 <code>delete-trailing-whitespaces</code> 或 <code>whitespaces-cleanup</code> 来管理多余的 whitespace</h3>
<div class="outline-text-3" id="text-9-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #c678dd;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">after-save-hook</span><span style="color: #51afef;">'</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">delete-trailing-whitespaces</span><span style="color: #51afef;">)</span>
<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#25110;</span>
<span style="color: #51afef;">(</span><span style="color: #c678dd;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">after-save-hook</span><span style="color: #51afef;">'</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">whitespace-cleanup</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
这两行时 Emacs 的常见配置，但在 Doom Emacs 中它们不是必须的。我们已经使用了更复杂的 <code>wsbutler</code> 来管理外来的 whitespace。然而，你可能会觉得它不起作用。这是因为 <code>wsbutler</code> 以两种不同寻常打方法工作，意味着没有其他选择那么强悍：
</p>

<ol class="org-ol">
<li><p>
它只会清除你碰过的行中的尾随空格（但始终会在 EOF 清除多余的空行）。为什么这样做？因为我相信整个文件范围的重新格式化应该是个值的商榷的行为（而不是盲目自动化）。如果有必要，那么你可能正在从事其他人的项目 —— 或正与其他人一起工作，但在这里，大规模的 whitespace 改变可能造成问题或只是粗鲁。我们不赞同 1%贡献和 99% whitespace 的 PR！
</p>

<p>
然而，如果真的有必要，可以调用 <code>deliberately</code> 替代 <code>M-x delete-trailing-whitespace</code> 或 <code>M-x whitespace-cleanup</code> 。
</p></li>

<li><p>
<code>wsbutler</code> 使用 <b>虚拟</b> whitespace 替换尾随空格和多余空行。 该 whitespace 仅存在于 Emacs 的 buffer 中，不会真正写入到文件。
</p>

<p>
为什么这样做？因为你可能想在当前的编辑会话中使用空格来存储某些内容，所以对编辑者来说在达到该内容之前将其删除是不方便的。
</p>

<p>
如果你使用 whitespace，它就在这里。如果你不适用，whitespace 也不会被写入到文件。
</p></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org6ce9584" class="outline-2">
<h2 id="org6ce9584"><span class="section-number-2">10</span> Troubleshoot</h2>
<div class="outline-text-2" id="text-10">
<p>
当遇到问题时，你应该准备收集信息以解决问题，或准备要编写的 bug report。Emacs 和 Doom 都提供了工具来使这一过程更加容易。这里有几件事你应该首先尝试：
</p>
<ul class="org-ul">
<li>查找 <code>*Messages*</code> 日志中的警告和错误信息。该日志可以使用 <code>SPC h e</code> 、 <code>C-h e</code> 或 <code>M-x view-echo-area-messages</code> 打开。</li>
<li>在 FAQ和<a href="https://github.com/hlissner/doom-emacs/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc">Doom的issue tracker</a>中查找错误/警告。你的问题可能已存在解决方法。FAQ 可以在 Doom 中使用 <code>SPC h d f</code> （或非 evil 用户使用 <code>C-h d f</code> ）来搜索。</li>
<li>在命名行运行 <code>bin/doom doctor</code> 来诊断环境和配置的常见问题。它还会为问题提出解决方法。</li>
<li><code>bin/doom clean</code> 会确保问题不是个人配置和 Doom core 的 bytecode 过时。如果你还没有使用 <code>bin/doom compile</code> ，那么就不需要运行此命令。</li>
<li><code>bin/doom sync</code> 会确保问题不是丢失 packages 或过期的 autoload 文件。</li>
<li><code>bin/doom build</code> 会确保问题不是陈旧的 package bytecode 或损坏的符号连接。</li>
<li><code>bin/doom update</code> 会确保 packages 时最新的，从而消除上游产生的问题。</li>
<li>如果你知道是哪个个模块相关的问题，检查它们的文档（按 <code>SPC h d m</code> 跳转到模块的文档）。你的问题可能已记录在文档中。</li>
<li>如果问题可以在原生 Emacs 并且/或者原生 Doom（没有个人配置的 Doom）中重现。<a href="https://github.com/hlissner/doom-emacs/blob/develop/docs/*Use%20the%20sandbox">Domm的shanbox可以帮助你检查</a>。</li>
<li>在<a href="https://discord.gg/qvGgnVx">Discord服务器</a>上请求帮助。这是得到帮助最快速的方法，有时直接从 Doom 的维护者那里获得帮助，Doom 的维护者在那里非常活跃。</li>
</ul>
<p>
如果以上这些都无法帮助到你，那么是时候提交错误报告了。关于如何提交有效的错误报错，见<a href="https://github.com/hlissner/doom-emacs/blob/develop/docs/contributing.org">contributing guidelines</a>中的"Reporting Issues"
</p>
</div>
</div>
<div id="outline-container-org1468ff6" class="outline-2">
<h2 id="org1468ff6"><span class="section-number-2">11</span> Links</h2>
<div class="outline-text-2" id="text-11">
<p>
<a href="https://github.com/hlissner/doom-emacs/blob/develop/docs/getting_started.org">https://github.com/hlissner/doom-emacs/blob/develop/docs/getting_started.org</a>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">&#20316;&#32773;: Petrus.Z</p>
<p class="date">Created: 2020-05-23 Sat 15:03</p>
</div>
</body>
</html>
