<!DOCTYPE html>
<html lang="zh-CN">
<head>
<!-- 2020-11-23 Mon 16:50 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>GPG</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Petrus.Z">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<style> #content{max-width:1400px;}</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.cacheClassElem = elem.className;
         elem.cacheClassTarget = target.className;
         target.className = "code-highlighted";
         elem.className   = "code-highlighted";
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(elem.cacheClassElem)
         elem.className = elem.cacheClassElem;
       if(elem.cacheClassTarget)
         target.className = elem.cacheClassTarget;
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../index.html"> UP </a>
 |
 <a accesskey="H" href="/index.html"> HOME </a>
</div><div id="content">
<h1 class="title">GPG</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgddb3d39">概念</a>
<ul>
<li><a href="#org0b67653">“主”（认证）密钥</a></li>
</ul>
</li>
<li><a href="#org6ef7d7c">Command</a>
<ul>
<li><a href="#org9faebea">常用命令</a></li>
<li><a href="#orge11f03d">添加 SSH keys</a></li>
<li><a href="#org673de17">导入他人公钥</a></li>
<li><a href="#orga44da15">文件加密解密、签名与验签</a></li>
</ul>
</li>
<li><a href="#org01ff9b2">密钥分离思想</a></li>
<li><a href="#orgd88645f">gpg-agent</a></li>
<li><a href="#org05db826">Links</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgddb3d39" class="outline-2">
<h2 id="orgddb3d39">概念</h2>
<div class="outline-text-2" id="text-orgddb3d39">
</div>
<div id="outline-container-org0b67653" class="outline-3">
<h3 id="org0b67653">“主”（认证）密钥</h3>
<div class="outline-text-3" id="text-org0b67653">
<ol class="org-ol">
<li>在“主密钥”和“子密钥”之间没有技术上的区别。</li>
<li>在创建时，我们赋予每个密钥特定的能力来分配功能限制。</li>
<li>一个 PGP 密钥有四项能力

<ol class="org-ol">
<li>[S] 密钥可以用于签名</li>
<li>[E] 密钥可以用于加密</li>
<li>[A] 密钥可以用于身份认证</li>
<li>[C] 密钥可以用于认证其他密钥</li>
</ol></li>

<li>一个密钥可能有多种能力</li>
</ol>

<p>
带有 [C] （认证）能力的密钥被认为是“主”密钥，因为它是唯一可以用来表明与其他密钥关系的密钥。只有 [C] 密钥可以被用于：
</p>

<ul class="org-ul">
<li>添加或撤销其他密钥（子密钥）的 S/E/A 能力</li>
<li>添加、更改或撤销密钥关联的身份（uid）</li>
<li>添加或更改本身或其他子密钥的到期时间</li>
<li>为了网络信任目的为其它密钥签名</li>
</ul>

<p>
在自由软件的世界里，[C] 密钥就是你的数字身份。一旦你创建该密钥，你应该格外小心地保护它并且防止它落入坏人的手中。
</p>
</div>
</div>
</div>

<div id="outline-container-org6ef7d7c" class="outline-2">
<h2 id="org6ef7d7c">Command</h2>
<div class="outline-text-2" id="text-org6ef7d7c">
</div>
<div id="outline-container-org9faebea" class="outline-3">
<h3 id="org9faebea">常用命令</h3>
<div class="outline-text-3" id="text-org9faebea">
<div class="org-src-container">
<pre class="src src-sh">    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#29983;&#25104;&#23494;&#38053;</span>
    gpg --expert --full-gen-key
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#32534;&#36753;&#23494;&#38053;&#65292;&#20855;&#20307;&#32534;&#36753;&#25805;&#20316;&#21487;&#35265;Links 1,2</span>
    gpg --expert --edit-key &lt;key/uid/email&gt;
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#26174;&#31034;&#20844;&#38053;</span>
    gpg -k
    gpg --list-keys
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#26174;&#31034;&#31169;&#38053;</span>
    gpg -K
    gpg --list-secret-keys
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#23558;key&#25552;&#20132;&#21040;keyserver</span>
    gpg --keyserver hkps://hkps.pool.sks-keyservers.net --send-keys &lt;keyid/uid&gt;
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#25163;&#21160;&#29983;&#25104;&#21514;&#38144;&#35777;&#20070;</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#19968;&#33324;&#22312;&#29983;&#25104;&#23494;&#38053;&#26102;&#20250;&#33258;&#21160;&#29983;&#25104;&#65292;&#20445;&#23384;&#22312;~/.gnupg/openpgp-revocs.d&#30446;&#24405;&#19979;</span>
    gpg --output revoke.asc --gen-revoke &lt;keyid/uid&gt;
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#21514;&#38144;&#23494;&#38053;&#65288;&#23548;&#20837;&#21514;&#38144;&#35777;&#20070;&#65289;</span>
    gpg --import ~/.gnupg/openpgp-revocs.d/&lt;keyid&gt;.rev
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#22312;keyserver&#20013;&#26356;&#26032;&#24050;&#21514;&#38144;&#30340;key</span>
    gpg --keyserver hkps://hkps.pool.sks-keyservers.net --send-keys &lt;keyid/uid&gt;
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#22312;keyserver&#20013;&#26597;&#25214;&#20844;&#38053;</span>
    gpg --keyserver hkps://hkps.pool.sks-keyservers.net --search-keys  &lt;keyid/uid&gt;
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#20174;keyserver&#23548;&#20837;&#20844;&#38053;</span>
    gpg --keyserver hkps://hkps.pool.sks-keyservers.net --recv-keys &lt;keyid/uid&gt;
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#23548;&#20986;&#20844;&#38053;</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#23548;&#20986;&#20026;&#20108;&#36827;&#21046;&#25991;&#20214;&#65306;</span>
    gpg --output yourname.gpg --export &lt;keyid/uid&gt;
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#23548;&#20986;&#20026;&#25991;&#26412;&#25991;&#20214;&#65306;</span>
    gpg --armor --output yourname.txt --export &lt;keyid/uid&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orge11f03d" class="outline-3">
<h3 id="orge11f03d">添加 SSH keys</h3>
<div class="outline-text-3" id="text-orge11f03d">
<div class="org-src-container">
<pre class="src src-sh">    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">1. &#23548;&#20986;authentication&#23376;&#23494;&#38053;&#20026;ssh&#20844;&#38053;</span>
    gpg --export-ssh-key &lt;keyid&gt;
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">2. &#23558;&#23548;&#20986;&#30340;ssh&#20844;&#38053;&#22797;&#21046;&#21040;&#38656;&#35201;&#30340;&#22320;&#26041;</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">3. &#36755;&#20986;authentication&#23376;&#23494;&#38053;&#30340;keygrip</span>
    gpg -k --with-keygrip
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">4. &#23558;&#36755;&#20986;&#30340;keygrip&#28155;&#21152;&#21040;~/.gnupg/sshcontrol&#20013;</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">5. &#36816;&#34892;gpg-agent&#24182;&#20351;&#29992;ssh-add -L&#21629;&#20196;&#30830;&#35748;&#28155;&#21152;&#25104;&#21151;</span>
    <span style="color: #5B6268;">#    </span><span style="color: #5B6268;">ssh-add -L&#36755;&#20986;&#30340;&#20540;&#19982;gpg --export-ssh-key&#21629;&#20196;&#30340;&#36755;&#20986;&#32467;&#26524;&#30456;&#21516;</span>
    ssh-add -L
</pre>
</div>
</div>
</div>

<div id="outline-container-org673de17" class="outline-3">
<h3 id="org673de17">导入他人公钥</h3>
<div class="outline-text-3" id="text-org673de17">
<div class="org-src-container">
<pre class="src src-sh">    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#20808;&#33719;&#21462;&#26576;&#20154;&#30340;&#20844;&#38053;&#65288;&#20174;&#20844;&#38053;&#26381;&#21153;&#22120;&#19978;&#65289;&#65306;</span>
    gpg --recv-keys &lt;keyid/uid&gt;
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#25110;&#32773;&#25351;&#23450;&#19968;&#20010; keyserver &#65306;</span>
    gpg --keyserver hkps://hkps.pool.sks-keyservers.net --recv-keys &lt;keyid/uid&gt;
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#25110;&#32773;&#20174;&#25991;&#20214;&#23548;&#20837;&#26576;&#20154;&#30340;&#20844;&#38053;&#65306;</span>
    gpg --import /tmp/file
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#26816;&#26597;&#19968;&#19979;&#25351;&#32441;&#65306;</span>
    gpg --fingerprint &lt;keyid/uid&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orga44da15" class="outline-3">
<h3 id="orga44da15">文件加密解密、签名与验签</h3>
<div class="outline-text-3" id="text-orga44da15">
<div class="org-src-container">
<pre class="src src-sh">    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">1. GPG&#21152;&#23494;&#25805;&#20316;&#65292;&#30001;&#21457;&#36865;&#26041;&#36827;&#34892;&#65292;&#39318;&#20808;&#33719;&#21462;&#25509;&#25910;&#26041;&#20844;&#38053;&#65292;&#20351;&#29992;&#20844;&#38053;&#21152;&#23494;&#25991;&#20214;</span>
    gpg --output &#21152;&#23494;&#36755;&#20986;&#25991;&#20214; --recipient &lt;uid&gt;  --encrypt &#24453;&#21152;&#23494;&#25991;&#20214;
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">--recipient&#21442;&#25968;&#21518;&#36319;&#23545;&#26041;&#30340;&#29992;&#25143;ID&#65307;--output&#21442;&#25968;&#21518;&#38754;&#36319;&#23548;&#20986;&#30340;&#25991;&#20214;&#21517;&#65307;--encrypt&#21442;&#25968;&#21518;&#36319;&#35201;&#21152;&#23494;&#30340;&#25991;&#20214;&#12290; &#36825;&#37324;&#24212;&#35813;&#27880;&#24847;&#19968;&#20010;&#38382;&#39064;&#65292;&#23601;&#26159;&#20320;&#35201;&#30830;&#23450;&#20320;&#20351;&#29992;&#30340;&#20844;&#38053;&#30340;&#21487;&#38752;&#24615;&#12290;</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#27880;&#24847;&#21442;&#25968;&#39034;&#24207;&#65292;--encrypt &#24453;&#21152;&#23494;&#25991;&#20214;&#22312;&#26368;&#21518;</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#23558;&#21152;&#23494;&#21518;&#30340;&#25991;&#20214;&#21457;&#36865;&#21040;&#25509;&#25910;&#26041;&#65292;&#22312;&#25509;&#25910;&#26041;&#35299;&#23494;</span>
    gpg --output &#35299;&#23494;&#36755;&#20986;&#25991;&#20214; --decrypt &#21152;&#23494;&#21518;&#30340;&#25991;&#20214;
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#27880;&#24847;&#21442;&#25968;&#39034;&#24207;&#65292;--decrypt &#21152;&#23494;&#21518;&#30340;&#25991;&#20214;&#22312;&#26368;&#21518;</span>

    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">2. &#25991;&#20214;&#31614;&#21517;&#25805;&#20316;&#30001;&#25991;&#20214;&#20998;&#21457;&#26041;&#26469;&#20570;&#65292;&#39318;&#20808;&#65292;&#20998;&#21457;&#26041;&#20351;&#29992;&#33258;&#24049;&#30340;&#23494;&#38053;&#23545;&#25991;&#20214;&#31614;&#21517;&#65292;</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#24182;&#23558;&#31614;&#21517;&#21518;&#30340;&#25991;&#20214;&#65288;&#25110;&#32773;&#25991;&#20214;&#19982;&#25991;&#20214;&#31614;&#21517;&#65289;&#20998;&#21457;&#20986;&#21435;&#12290;</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#25509;&#25910;&#32773;&#20351;&#29992;&#20998;&#21457;&#26041;&#30340;&#20844;&#38053;&#23545;&#25991;&#20214;&#36827;&#34892;&#39564;&#31614;&#65292;&#35777;&#26126;&#25991;&#20214;&#27809;&#26377;&#34987;&#31713;&#25913;&#12290;</span>
    gpg --sign xxxx.xxx
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#36825;&#20010;&#21629;&#20196;&#20250;&#22312;&#24403;&#21069;&#30446;&#24405;&#19979;&#29983;&#25104; xxxx.xxx.gpg&#65292;&#36825;&#26159;&#31614;&#21517;&#21518;&#30340;&#25991;&#20214;&#12290;&#37319;&#29992;&#20108;&#36827;&#21046;&#20648;&#23384;&#12290;</span>
    gpg --clear-sign xxxx.xxx
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#36825;&#20010;&#21629;&#20196;&#20250;&#29983;&#25104;ASCII&#31614;&#21517;&#21518;&#30340;&#25991;&#20214;&#12290;&#25991;&#20214;&#21517;&#20026;xxxx.xxx.asc&#12290;&#31614;&#21517;&#34987;&#28155;&#21152;&#22312;&#25991;&#20214;&#22836;&#21644;&#25991;&#20214;&#23614;&#12290;</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#20197;&#19978;&#20004;&#20010;&#21629;&#20196;&#37117;&#26159;&#23558;&#31614;&#21517;&#28155;&#21152;&#21040;&#25991;&#20214;&#20013;&#65292;&#19968;&#33324;&#37117;&#19981;&#20250;&#29992;&#12290;</span>
    gpg --detach-sign xxxx.xxx
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#36825;&#20010;&#21629;&#20196;&#20250;&#22312;&#24403;&#21069;&#30446;&#24405;&#19979;&#29983;&#25104; xxxx.xxx.sig &#36825;&#26159;&#25991;&#20214;&#30340;&#31614;&#21517;&#12290;&#37319;&#29992;&#20108;&#36827;&#21046;&#20648;&#23384;&#12290;</span>
    gpg --detach-sign --armor xxxx.xxx
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#36825;&#20010;&#21629;&#20196;&#20250;&#29983;&#25104;&#25991;&#20214;&#30340;ASCII&#31614;&#21517;xxxx.xxx.asc&#12290;</span>

    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">3. &#39564;&#35777;&#31614;&#21517;</span>
    gpg --verify --output &#36755;&#20986;&#25991;&#20214; xxxx.xxx.gpg
    gpg --verify --output &#36755;&#20986;&#25991;&#20214; xxxx.xxx.asc
    gpg --verify xxxx.xxx.sig
    gpg --verify xxxx.xxx.asc
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#19978;&#38754;&#22235;&#31181;&#39564;&#31614;&#26041;&#24335;&#23545;&#24212;&#22235;&#31181;&#31614;&#21517;&#26041;&#24335;&#12290;</span>

    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">4. extras</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#25351;&#23450;&#29992;&#26576;&#20010;&#31169;&#38053;&#31614;&#21517;&#65306;</span>
    gpg -u YYYYYYYY --sign-key XXXXXXXX
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#20877;&#35201;&#27714;&#35810;&#38382;&#31614;&#21517;&#30340;&#36807;&#26399;&#26085;&#26399;&#65306;</span>
    gpg -u YYYYYYY --sign-key --ask-cert-expire XXXXXXXX
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#20877;&#35201;&#27714;&#35810;&#38382;&#26377;&#25928;&#24615;&#65306;</span>
    gpg -u YYYYYYY --sign-key --ask-cert-expire --ask-cert-level XXXXXXXX
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#23548;&#20986;&#24182;&#21457;&#36865;&#32473;&#21035;&#20154;</span>
    gpg --armor --export XXXXXXXX | gpg --encrypt -r XXXXXXXX --armor --output XXXXXXXX-signedBy-YYYYYYYY.asc
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org01ff9b2" class="outline-2">
<h2 id="org01ff9b2">密钥分离思想</h2>
<div class="outline-text-2" id="text-org01ff9b2">
<p>
该使用且只使用子密钥，主密钥应该放在一个绝对安全的地方。
</p>

<p>
无论加密还是签名都可以直接使用公钥，但我们并不推荐这样做，因为如果直接使用公钥，而密钥又不小心被泄露了，我们就不得不吊销整个密钥。
</p>

<p>
为了解决这一问题，我们应该使用且只使用子密钥，这样如果子密钥被泄露了，我们仅需要吊销被泄露的子密钥，这样主密钥仍是安全的，然后用主密钥生成新的子密钥继续使用。
</p>

<ol class="org-ol">
<li><p>
备份所有密钥，删除当前机器上的主密钥
</p>

<div class="org-src-container">
<pre class="src src-sh">       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">1. &#23548;&#20986;&#23494;&#38053;</span>
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#23548;&#20986;&#25152;&#26377;&#23494;&#38053;&#65292;&#20316;&#20026;&#22791;&#20221;&#65306;</span>
       gpg --output all_secret_keys --export-secret-keys &lt;keyid/uid&gt;
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#23548;&#20986;&#26576;&#20010;&#23376;&#23494;&#38053;&#65306;</span>
       gpg --output some_secret_subkeys --export-secret-subkeys &lt;keyid&gt;!
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#21487;&#20197;&#21333;&#29420;&#23548;&#20986;&#65292;&#20063;&#21487;&#20197;&#19968;&#21516;&#23548;&#20986;&#65292;&#27880;&#24847; ID &#21518;&#30340;&#24863;&#21497;&#21495;&#65292;&#27492;&#31526;&#21495;&#30830;&#20445;&#20027;&#23494;&#38053;&#19981;&#20250;&#34987;&#21516;&#26102;&#23548;&#20986;&#65292;&#20877;&#20363;&#22914;&#65306;</span>
       gpg --output some_secret_subkeys --export-secret-subkeys &lt;keyid1&gt;! &lt;keyid2&gt;!
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">2. &#21024;&#38500;&#23494;&#38053;</span>
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#21024;&#38500;&#31169;&#38053;&#65306;</span>
       gpg --delete-secret-keys &lt;keyid/uid&gt;
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#21024;&#38500;&#20844;&#38053;&#65306;</span>
       gpg --delete-keys &lt;keyid/uid&gt;
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#25110;&#32773;&#65292;&#23558;&#20197;&#19978;&#20004;&#26465;&#21629;&#20196;&#21512;&#20026;&#65306;</span>
       gpg --delete-secret-and-public-key &lt;keyid/uid&gt;
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">3. &#37325;&#26032;&#23548;&#20837;&#23376;&#23494;&#38053;&#65306;</span>
       gpg --import some_secret_subkeys
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#22914;&#27492;&#20197;&#26469;&#65292;&#23454;&#29616;&#20102;&#20027;&#12289;&#23376;&#23494;&#38053;&#20998;&#31163;</span>
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">4. &#20449;&#20219;&#23494;&#38053;&#65306;</span>
       gpg --edit-key &lt;keyid/uid&gt;
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#36755;&#20837;trust&#21629;&#20196;&#65288;&#36807;&#31243;&#30053;&#65289;</span>
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">5. &#20570;&#22909;&#23548;&#20986;&#30340;&#31169;&#38053;&#30340;&#22791;&#20221;&#65292;&#21024;&#38500;&#19981;&#38656;&#35201;&#30340;&#25991;&#20214;&#12290;</span>
</pre>
</div></li>

<li><p>
备份所有密钥到加密的移动介质，删除主密钥，在移动介质中使用 gpg
</p>

<div class="org-src-container">
<pre class="src src-sh">       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">1. &#22791;&#20221;home&#30446;&#24405;&#19979;&#30340; .gnupg &#21040;&#21152;&#23494;&#30340;&#31227;&#21160;&#20171;&#36136;&#19978;&#12290;</span>
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">2. &#21024;&#38500;&#20027;&#23494;&#38053;</span>
       gpg --with-keygrip --list-key &lt;keyid/uid&gt;
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#25214;&#21040;&#20027;&#23494;&#38053;&#30340; keygrip &#65292;&#35760;&#20303;&#12290;&#22312; ~/.gnupg/private-keys-v1.d &#19979;&#21024;&#38500;&#23545;&#24212;&#30340;&#20027;&#23494;&#38053;&#25991;&#20214;&#12290;</span>
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">3. &#21487;&#20197;&#25351;&#23450;&#22312;&#31227;&#21160;&#20171;&#36136;&#30340;&#29615;&#22659;&#37324;&#36816;&#34892; gpg &#65306;</span>
       gpg --homedir &lt;dir&gt; &lt;some commands here&gt;
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">4. &#22791;&#20221;&#24182;&#21024;&#38500;&#21514;&#38144;&#35777;&#20070;</span>
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#30830;&#20445; ~/.gnupg/openpgp-revocs.d &#24050;&#23433;&#20840;&#22791;&#20221;&#12290;&#21024;&#38500;&#19978;&#36848;&#25991;&#20214;&#22841;&#12290;</span>
</pre>
</div></li>

<li><p>
使用 2 个 U 盘，导出密钥到 1 号 U 盘，导出子密钥到 2 号 U 盘，并将吊销证书导入到 1 号 U 盘。删除刚生成的密钥。
</p>

<p>
此时，1号 U 盘中有密钥和吊销证书，2号 U 盘中有子密钥。将 1 号 U 盘保存到一个*绝对安全的地方*。
</p>

<p>
在需要使用 GPG 的机器中插入 2 号 U 盘，导入到本地中并修改信任度，并将其公钥发送到 keyserver 上，这样就可以安全的仅使用子密钥。
</p>

<div class="org-src-container">
<pre class="src src-sh">       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">1. &#23548;&#20986;&#23494;&#38053;&#21040;1&#21495;U&#30424;</span>
       gpg -o /run/media/mogeko/USB1/gpg_key --export-secret-keys &lt;keyid&gt;
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">2. &#23548;&#20986;&#23376;&#23494;&#38053;&#21040;2&#21495;U&#30424;</span>
       gpg -o /run/media/mogeko/USB2/gpg_key.sub --export-secret-subkeys &lt;keyid&gt;
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">3. &#29983;&#25104;&#21514;&#38144;&#35777;&#20070;&#24182;&#20445;&#23384;&#26089;1&#21495;U&#30424;&#20013;&#65288;&#36807;&#31243;&#30053;&#65289;</span>
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">4. &#21024;&#38500;&#21018;&#29983;&#25104;&#30340;&#23494;&#38053;</span>
       gpg --delete-secret-keys &lt;keyid&gt;
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">5. &#22312;&#26412;&#22320;&#23548;&#20837;2&#21495;U&#30424;&#20013;&#30340;&#23376;&#23494;&#38053;</span>
       gpg --import /run/media/mogeko/USB2/gpg_key.sub
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">6. &#20462;&#25913;&#35813;&#23376;&#23494;&#38053;&#30340;&#20449;&#20219;&#24230;&#65288;&#36807;&#31243;&#39069;&#65289;</span>
       <span style="color: #5B6268;"># </span><span style="color: #5B6268;">7. &#23558;&#20844;&#38053;&#21457;&#36865;&#21040;keyserver&#20013;</span>
       gpg --keyserver hkps://hkps.pool.sks-keyservers.net --send-keys &lt;keyid&gt;
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-orgd88645f" class="outline-2">
<h2 id="orgd88645f">gpg-agent</h2>
</div>

<div id="outline-container-org05db826" class="outline-2">
<h2 id="org05db826">Links</h2>
<div class="outline-text-2" id="text-org05db826">
<ol class="org-ol">
<li><a href="https://wiki.gentoo.org/wiki/Project:Infrastructure/Generating_GLEP_63_based_OpenPGP_keys">Generating GLEP 63 based OpenPGP keys</a></li>
<li><a href="https://wiki.archlinux.org/index.php/GnuPG">archwiki GnuPG</a></li>
<li><a href="https://blog.chaos.run/dreams/using-gpg/">如何使用 GPG 管理密钥</a></li>
<li><a href="https://www.bitlogs.tech/2019/01/gpg%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">GPG使用教程</a></li>
<li><a href="https://mogeko.me/2019/068/">GPG 的正确使用姿势</a></li>
<li><a href="https://linux.cn/article-10432-1.html">用 PGP 保护代码完整性</a></li>
</ol>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">&#20316;&#32773;: Petrus.Z</p>
<p class="date">Created: 2020-11-23 Mon 16:50</p>
</div>
</body>
</html>
